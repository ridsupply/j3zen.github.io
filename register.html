
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คลินิกพัสดุ บก.ทท.</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f1f8ff 25%, #ffffff 50%, #f0f9ff 75%, #e6f3ff 100%);
            min-height: 100vh;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(179, 205, 224, 0.3);
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.15);
        }
        
        .logo-container {
            background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 50%, #f0f9ff 100%);
            border: 1px solid rgba(147, 197, 253, 0.5);
        }
        
        .profile-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #ffffff 100%);
            border: 1px solid rgba(147, 197, 253, 0.3);
        }
        
        .input-field, .select-field {
            border: 2px solid #bfdbfe;
            background: rgba(240, 249, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .input-field:focus, .select-field:focus {
            border-color: #60a5fa;
            background: rgba(240, 249, 255, 0.8);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .time-badge {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .status-online {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(59, 130, 246, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .loading-spinner {
            border: 6px solid rgba(147, 197, 253, 0.3);
            border-top: 6px solid #3b82f6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .input-error {
            border-color: #dc2626 !important;
            background: rgba(254, 226, 226, 0.5) !important;
        }

        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="main-container max-w-md w-full rounded-3xl overflow-hidden">
        
        <!-- Logo Section -->
        <div class="logo-container p-8 text-center">
            <div class="floating-animation inline-block">
                <div class="w-24 h-24 mx-auto mb-4 rounded-full bg-white shadow-lg flex items-center justify-center overflow-hidden">

                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Emblem_of_the_Royal_Thai_Armed_Forces_%282024%29.svg/1200px-Emblem_of_the_Royal_Thai_Armed_Forces_%282024%29.svg.png" 
                         alt="คลินิกพัสดุ บก.ทท." class="w-20 h-20 object-contain">
                </div>
            </div>
            <h1 class="text-2xl font-bold text-blue-800 mb-2">คลินิกพัสดุ บก.ทท.</h1>
            <p class="text-blue-600 text-sm">ลงทะเบียน</p>
        </div>

        <!-- Profile Section -->
        <div class="profile-card p-4 m-4 rounded-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <img id="profileImage" src="https://cdn.pixabay.com/animation/2022/11/04/09/42/09-42-03-510_512.gif" 
                         alt="Profile" class="w-16 h-16 rounded-full border-4 border-white shadow-lg mr-4">
                    <div>
                        <h4 id="displayName" class="text-lg font-semibold text-blue-800">ยินดีต้อนรับ</h4>
                        <p id="statusMessage" class="text-blue-600 text-sm">กำลังโหลดข้อมูล</p>
                        <span id="userStatus" class="status-online inline-block px-3 py-1 text-xs font-semibold text-white rounded-full mt-1">
                            Online
                        </span>
                    </div>
                </div>
                <div id="timeDisplay" class="time-badge text-white px-3 py-2 rounded-full text-sm font-semibold">
                    00:00:00
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message mx-6">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>ลงทะเบียนเรียบร้อย</span>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="p-6">
            <form id="registrationForm" class="space-y-4">
                <div>
                    <label for="firstName" class="block text-blue-800 text-sm font-semibold mb-2">
                        ชื่อ <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="firstName" name="firstName" 
                           class="input-field w-full py-3 px-4 rounded-xl focus:outline-none font-medium" 
                           placeholder="กรุณากรอกชื่อ" required>
                    <div class="error-message" id="firstNameError">กรุณากรอกชื่อ</div>
                </div>
              
                <div>
                    <label for="lastName" class="block text-blue-800 text-sm font-semibold mb-2">
                        นามสกุล <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="lastName" name="lastName" 
                           class="input-field w-full py-3 px-4 rounded-xl focus:outline-none font-medium" 
                           placeholder="กรุณากรอกนามสกุล" required>
                    <div class="error-message" id="lastNameError">กรุณากรอกนามสกุล</div>
                </div>
                
                <div>
                    <label for="mainDepartment" class="block text-blue-800 text-sm font-semibold mb-2">
                        กรม/สำนัก <span class="text-red-400">*</span>
                    </label>
                    <select id="mainDepartment" name="mainDepartment" 
                            class="select-field w-full py-3 px-4 rounded-xl focus:outline-none font-medium" required>
                        <option value="">เลือก กรม/สำนัก ของท่าน</option>
                    </select>
                    <div class="error-message" id="mainDepartmentError">กรุณาเลือกกรม/สำนัก</div>
                </div>
                
                <div>
                    <label for="subDepartment" class="block text-blue-800 text-sm font-semibold mb-2">
                        หน่วยงาน <span class="text-red-400">*</span>
                    </label>
                    <select id="subDepartment" name="subDepartment" 
                            class="select-field w-full py-3 px-4 rounded-xl focus:outline-none font-medium" required>
                        <option value="">เลือกหน่วยงาน</option>
                    </select>
                    <div class="error-message" id="subDepartmentError">กรุณาเลือกหน่วยงาน</div>
                </div>
                
                <div>
                    <label for="tel" class="block text-blue-800 text-sm font-semibold mb-2">
                        เบอร์โทร <span class="text-red-400">*</span>
                    </label>
                    <input type="tel" id="tel" name="tel" 
                           class="input-field w-full py-3 px-4 rounded-xl focus:outline-none font-medium" 
                           placeholder="กรุณากรอกเบอร์โทร" required>
                    <div class="error-message" id="telError">กรุณากรอกเบอร์โทรของท่าน</div>
                </div>     
              
                <div>
                    <label for="email" class="block text-blue-800 text-sm font-semibold mb-2">
                        อีเมล <span class="text-red-400">*</span>
                    </label>
                    <input type="email" id="email" name="email" 
                           class="input-field w-full py-3 px-4 rounded-xl focus:outline-none font-medium" 
                           placeholder="กรุณากรอกอีเมล" required>
                    <div class="error-message" id="emailError">กรุณากรอกอีเมลให้ถูกต้อง</div>
                </div>                        
                
                <div class="pt-4">
                    <button type="submit" id="submitBtn" class="btn-primary w-full text-white font-bold py-4 px-6 rounded-xl focus:outline-none">
                        <span class="flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            ลงทะเบียน
                        </span>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Footer -->
        <div class="glass-effect p-4 text-center">
            <p class="text-blue-600 text-xs">© 2025 คลินิกพัสดุ บก.ทท.</p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-blue-800 font-semibold">กำลังบันทึกข้อมูล...</p>
        </div>
    </div>

    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        const liffId = '2007475227-vOjR1w0J'; // Replace with your LIFF ID

        // Validation functions
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePhone(phone) {
            const re = /^[0-9-+\s()]{10,15}$/;
            return re.test(phone.replace(/\s/g, ''));
        }

        function showError(fieldId, errorId, message) {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(errorId);
            field.classList.add('input-error');
            error.textContent = message;
            error.style.display = 'block';
        }

        function hideError(fieldId, errorId) {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(errorId);
            field.classList.remove('input-error');
            error.style.display = 'none';
        }

        function validateForm() {
            let isValid = true;
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const mainDepartment = document.getElementById('mainDepartment').value.trim();
            const subDepartment = document.getElementById('subDepartment').value.trim();
            const tel = document.getElementById('tel').value.trim();
            const email = document.getElementById('email').value.trim();

            // Reset all errors
            hideError('firstName', 'firstNameError');
            hideError('lastName', 'lastNameError');
            hideError('mainDepartment', 'mainDepartmentError');
            hideError('subDepartment', 'subDepartmentError');
            hideError('tel', 'telError');
            hideError('email', 'emailError');

            // Validate first name
            if (!firstName) {
                showError('firstName', 'firstNameError', 'กรุณากรอกชื่อ');
                isValid = false;
            }
            
            // Validate first name
            if (!lastName) {
                showError('lastName', 'lastNameError', 'กรุณากรอกนามสกุล');
                isValid = false;
            }
          
            // Validate main department
            if (!mainDepartment) {
                showError('mainDepartment', 'mainDepartmentError', 'กรุณาเลือกหน่วยงาน สำนัก/กอง');
                isValid = false;
            }

            // Validate sub department
            if (!subDepartment) {
                showError('subDepartment', 'subDepartmentError', 'กรุณาเลือกหน่วยงาน');
                isValid = false;
            }

            // Validate phone
            if (!tel) {
                showError('tel', 'telError', 'กรุณากรอกเบอร์โทรของท่าน');
                isValid = false;
            } else if (!validatePhone(tel)) {
                showError('tel', 'telError', 'รูปแบบเบอร์โทรไม่ถูกต้อง');
                isValid = false;
            }

            // Validate email
            if (!email) {
                showError('email', 'emailError', 'กรุณากรอกอีเมล');
                isValid = false;
            } else if (!validateEmail(email)) {
                showError('email', 'emailError', 'รูปแบบอีเมลไม่ถูกต้อง');
                isValid = false;
            }

            return isValid;
        }

        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('timeDisplay').textContent = `${hours}:${minutes}:${seconds}`;
        }

        setInterval(updateTime, 1000);
        updateTime(); 

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('submitBtn').disabled = true;
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
        }

        function showSuccess() {
            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 3000);
        }

        async function fetchDepartments() {
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbwN9TR7Dba8O_NbnLo6z2I8g64TBdmDXeWrOhEKuqW2l8fcussHPCXYsOyOQE8We6hB/exec?action=getDepartment');
                const data = await response.json();
                if (data.departments) {
                    window.departmentData = data.departments; // Store data globally
                    populateMainDepartments(data.departments);
                } else {
                    throw new Error('Invalid department data');
                }
            } catch (error) {
                console.error('Error fetching departments:', error);
                Swal.fire({
                    title: 'เกิดข้อผิดพลาด',
                    text: 'ไม่สามารถดึงข้อมูลหน่วยงานได้',
                    icon: 'error'
                });
            }
        }

        function populateMainDepartments(departments) {
            const mainDeptSelect = document.getElementById('mainDepartment');
            mainDeptSelect.innerHTML = '<option value="">เลือกหน่วยงาน สำนัก/กอง</option>';
            const uniqueMainDepts = [...new Set(departments.map(row => row.mainDepartment).filter(val => val))];
            uniqueMainDepts.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                mainDeptSelect.appendChild(option);
            });
        }

        function populateSubDepartments(selectedMainDept) {
            const subDeptSelect = document.getElementById('subDepartment');
            subDeptSelect.innerHTML = '<option value="">เลือกหน่วยงาน</option>';
            if (selectedMainDept && window.departmentData) {
                const subDepartments = window.departmentData
                    .filter(row => row.mainDepartment === selectedMainDept && row.subDepartment)
                    .map(row => row.subDepartment);
                const uniqueSubDepts = [...new Set(subDepartments)];
                uniqueSubDepts.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    subDeptSelect.appendChild(option);
                });
            }
        }

        async function initializeLiff() {
            try {
                await liff.init({ liffId: liffId });
                if (liff.isLoggedIn()) {
                    const profile = await liff.getProfile();
                    document.getElementById('displayName').textContent = profile.displayName;
                    document.getElementById('statusMessage').textContent = profile.statusMessage || ' ';
                    document.getElementById('profileImage').src = profile.pictureUrl || "https://lh3.googleusercontent.com/d/1PHooavPU4Ox-YkZylJQTU_eiPOPIQWjd";
                    document.getElementById('userStatus').textContent = liff.isLoggedIn() ? 'Online' : 'Offline';
                    await fetchDepartments();
                } else {
                    liff.login();
                }
            } catch (error) {
                console.error('LIFF initialization error:', error);
                Swal.fire({
                    title: 'เกิดข้อผิดพลาด',
                    text: 'ไม่สามารถเชื่อมต่อกับ LINE ได้',
                    icon: 'error'
                });
            }
        }

        async function sendToGoogleSheet(userId, firstName , lastName, mainDepartment, subDepartment, tel, email) {
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbwY_W2tSAk49D-v8k59EkKb8UV-Se7enRWfaCGFxx8kprzyZAe-EtAnoig0v8NEuYx1/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        userId: userId,
                        firstName: firstName,
                        lastName: lastName,
                        mainDepartment: mainDepartment,
                        subDepartment: subDepartment,
                        tel: tel,
                        email: email,
                    })
                });

                const result = await response.json();
                if (response.ok && result.status === 'success') {
                    await sendFlexMessage('Register');
                    showSuccess();
                    return true;
                } else {
                    throw new Error(result.message || 'เกิดข้อผิดพลาดในการบันทึกข้อมูล');
                }
            } catch (error) {
                console.error('Error sending data to Google Sheets:', error);
                throw error;
            }
        }

        document.getElementById('mainDepartment').addEventListener('change', function() {
            const selectedMainDept = this.value;
            populateSubDepartments(selectedMainDept);
        });

        document.getElementById('registrationForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            if (!validateForm()) {
                return;
            }

            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const mainDepartment = document.getElementById('mainDepartment').value.trim();
            const subDepartment = document.getElementById('subDepartment').value.trim();
            const tel = document.getElementById('tel').value.trim();
            const email = document.getElementById('email').value.trim();
            
            try {
                const userId = liff.getDecodedIDToken().sub;
                showLoading();
                
                await sendToGoogleSheet(userId, firstName , lastName, mainDepartment, subDepartment, tel, email);
                document.getElementById('registrationForm').reset();
                populateSubDepartments(''); // Reset sub-department dropdown
                
            } catch (error) {
                console.error('Registration error:', error);
                Swal.fire({
                    title: 'เกิดข้อผิดพลาด',
                    text: 'ไม่สามารถลงทะเบียนได้ กรุณาลองใหม่อีกครั้ง',
                    icon: 'error'
                });
            } finally {
                hideLoading();
            }
        });

        initializeLiff();

      
      async function sendFlexMessage(type) {
    try {
        const now = new Date();
        const time = now.toLocaleString('th-TH', { dateStyle: 'short', timeStyle: 'short' });
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const mainDepartment = document.getElementById('mainDepartment').value.trim();
        const subDepartment = document.getElementById('subDepartment').value.trim();
        const tel = document.getElementById('tel').value.trim();
        const email = document.getElementById('email').value.trim();
        const profile = await liff.getProfile();

        const message = {
            type: 'flex',
            altText: `การลงทะเบียนสำเร็จเมื่อ ${time}`,
            contents: 
          
          {
                type: 'bubble',
                size: 'mega', // Larger size for better visibility
                header: {
                    type: 'box',
                    layout: 'vertical',
                    contents: [
                        {
                            type: 'text',
                            text: 'คุณลงทะเบียนเรียบร้อยแล้ว',
                            weight: 'bold',
                            color: '#ffffff',
                            size: 'md',
                            align: 'center'
                        },
                        {
                            type: 'text',
                            text: `วันที่ ${time}`,
                            color: '#e0f2fe',
                            size: 'xs',
                            align: 'center',
                            margin: 'sm'
                        }
                    ],
                    backgroundColor: '#3b82f6', // Primary blue from HTML
                    paddingAll: 'md',
                    paddingTop: 'lg',
                    paddingBottom: 'sm'
                },
            
                body: {
                    type: 'box',
                    layout: 'vertical',
                    contents: [
                        // Profile Section
                        {
                            type: 'box',
                            layout: 'horizontal',
                            contents: [
                                {
                                    type: 'image',
                                    url: profile.pictureUrl || 'https://lh3.googleusercontent.com/d/17dCmXr6QsiF847W3K6FBtPEpS8yFPZE8',
                                    size: 'sm',
                                    aspectRatio: '1:1',
                                    aspectMode: 'cover',
                                    gravity: 'center',
                                    
                                },
                                {
                                    type: 'box',
                                    layout: 'vertical',
                                    contents: [
                                        {
                                            type: 'text',
                                            text: firstName,
                                            weight: 'bold',
                                            size: 'sm',
                                            color: '#1e40af', // Darker blue for text
                                            wrap: true,
                                            margin: 'sm'
                                        }
                                    ],
                                    justifyContent: 'center',
                                    paddingStart: '10px'
                                },
                                {
                                      type: 'box',
                                      layout: 'vertical',
                                      contents: [
                                          {
                                              type: 'text',
                                              text: lastName,
                                              weight: 'bold',
                                              size: 'sm',
                                              color: '#1e40af', // Darker blue for text
                                              wrap: true,
                                              margin: 'sm'
                                          }
                                      ],
                                      justifyContent: 'center'
                                      
                                  }
                            ],
                            spacing: 'md',
                            paddingAll: 'md',
                            backgroundColor: '#ffffff' // Light blue background from HTML
                            
                        },
                        // Separator
                        {
                            type: 'separator',
                            margin: 'lg',
                            color: '#bfdbfe' // Light blue separator
                        },
                        // Details Section
                        {
                            type: 'box',
                            layout: 'vertical',
                            contents: [
                                {
                                    type: 'box',
                                    layout: 'horizontal',
                                    contents: [
                                        {
                                            type: 'text',
                                            text: 'สำนัก/กอง :',
                                            size: 'sm',
                                            color: '#6b7280', // Gray for labels
                                            weight: 'bold',
                                            flex: 2
                                        },
                                        {
                                            type: 'text',
                                            text: mainDepartment,
                                            size: 'sm',
                                            color: '#1e40af',
                                            wrap: true,
                                            flex: 3
                                        }
                                    ],
                                    spacing: 'sm',
                                    margin: 'sm'
                                },
                                {
                                    type: 'box',
                                    layout: 'horizontal',
                                    contents: [
                                        {
                                            type: 'text',
                                            text: 'หน่วยงาน :',
                                            size: 'sm',
                                            color: '#6b7280',
                                            weight: 'bold',
                                            flex: 2
                                        },
                                        {
                                            type: 'text',
                                            text: subDepartment,
                                            size: 'sm',
                                            color: '#1e40af',
                                            wrap: true,
                                            flex: 3
                                        }
                                    ],
                                    spacing: 'sm',
                                    margin: 'sm'
                                },
                                {
                                    type: 'box',
                                    layout: 'horizontal',
                                    contents: [
                                        {
                                            type: 'text',
                                            text: 'โทร :',
                                            size: 'sm',
                                            color: '#6b7280',
                                            weight: 'bold',
                                            flex: 2
                                        },
                                        {
                                            type: 'text',
                                            text: tel,
                                            size: 'sm',
                                            color: '#1e40af',
                                            wrap: true,
                                            flex: 3
                                        }
                                    ],
                                    spacing: 'sm',
                                    margin: 'sm'
                                },
                                {
                                    type: 'box',
                                    layout: 'horizontal',
                                    contents: [
                                        {
                                            type: 'text',
                                            text: 'อีเมล :',
                                            size: 'sm',
                                            color: '#6b7280',
                                            weight: 'bold',
                                            flex: 2
                                        },
                                        {
                                            type: 'text',
                                            text: email,
                                            size: 'sm',
                                            color: '#1e40af',
                                            wrap: true,
                                            flex: 3
                                        }
                                    ],
                                    spacing: 'sm',
                                    margin: 'sm'
                                }
                            ],
                            paddingAll: 'md'
                        }
                    ],
                    backgroundColor: '#ffffff' // White background for body
                },
                footer: {
                    type: 'box',
                    layout: 'vertical',
                    contents: [
                        {
                            type: 'text',
                            text: 'คลินิกพัสดุ บก.ทท.',
                            size: 'xs',
                            color: '#6b7280',
                            align: 'center',
                            margin: 'sm'
                        }
                    ],
                    backgroundColor: '#e0f2fe', // Light blue footer
                    paddingAll: 'sm'
                }
            }
          
        };

        await liff.sendMessages([message]);
        // Delay window closure to allow success message visibility
        // setTimeout(() => liff.closeWindow(), 2000);
        liff.closeWindow()
    } catch (error) {
        console.error('Error sending Flex Message:', error);
        Swal.fire({
            title: 'เกิดข้อผิดพลาด',
            text: 'ไม่สามารถส่งข้อความยืนยันการลงทะเบียนได้ กรุณาลองใหม่อีกครั้ง',
            icon: 'error'
        });
    }
}
    </script>
